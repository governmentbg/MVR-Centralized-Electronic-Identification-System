<section class="h-100 provider-register-section" *transloco="let t">
    <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>
    <div class="row">
        <div class="col">
            <h4 class="mb-4 text-text-default">
                {{ t('modules.centers.circumstances.txtTitle') }}
            </h4>
            <p-card>
                <ng-container *ngIf="!loading && circumstanceDetails; else elseBlock">
                    <p-tabView>
                        <p-tabPanel [header]="t('modules.centers.register.details')">
                            <div class="row mb-2">
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.centers.register.administrativeBodyName')"
                                        [value]="circumstanceDetails.name" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.centers.register.companyNameLatin')"
                                        [value]="circumstanceDetails.nameLatin" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.centers.register.administrativeBodyBulstat')"
                                        [value]="circumstanceDetails.eikNumber" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.centers.register.homePage')"
                                        [value]="circumstanceDetails.homePage" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.centers.register.administrativeBodyAddress')"
                                        [value]="circumstanceDetails.address" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.centers.register.administrativeBodyEmail')"
                                        [value]="circumstanceDetails.email" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.centers.register.administrativeBodyPhone')"
                                        [value]="circumstanceDetails.phone" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.centers.register.generalInformation')"
                                        [value]="circumstanceDetails.description" />
                                </div>
                            </div>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.centers.register.legalRepresentatives')">
                            <p-table
                                [value]="circumstanceDetails.authorizedPersons || []"
                                [tableStyle]="{ 'min-width': '100%' }"
                                [rowHover]="true"
                                [rowSelectable]="false">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.administratorUidType') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtName') }}
                                            <p-sortIcon field="name"></p-sortIcon>
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtNameLatin') }}
                                            <p-sortIcon field="name"></p-sortIcon>
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtEmail') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtPhone') }}
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-user let-rowIndex="rowIndex">
                                    <tr [ngClass]="{ 'text-button-confirm fw-bold': user.isActive === null }">
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.citizenIdentifierNumber"
                                            [title]="user.citizenIdentifierNumber">
                                            <span
                                                class="multiline-ellipsis"
                                                appPersonalIdentifier
                                                [identifier]="user.citizenIdentifierNumber"
                                                [identifierType]="user.citizenIdentifierType"></span>
                                        </td>
                                        <td style="max-width: 18rem" [attr.aria-label]="user.name" [title]="user.name">
                                            <span class="multiline-ellipsis">{{ user.name }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.nameLatin"
                                            [title]="user.nameLatin">
                                            <span class="multiline-ellipsis">{{ user.nameLatin }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.email"
                                            [title]="user.email">
                                            <span class="multiline-ellipsis">{{ user.email }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.phoneNumber"
                                            [title]="user.phoneNumber">
                                            <span class="multiline-ellipsis">{{ user.phoneNumber }}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="5">
                                            <span
                                                class="d-flex align-items-center flex-column empty-message-container bg-background-light-grey">
                                                <img src="/assets/images/noresults.png" [alt]="t('aria.txtLogo')" />
                                                <span class="text-text-light" [attr.aria-label]="t('global.txtNoData')">
                                                    {{ t('global.txtNoData') }}
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.centers.register.offices')">
                            <p-table
                                [value]="circumstanceDetails.eidManagerFrontOffices || []"
                                [tableStyle]="{ 'min-width': '100%' }"
                                [rowHover]="true"
                                [rowSelectable]="false">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.officeName') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.officeAddress') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.officeCoordinates') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.officeGeneralInformation') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.workingHours') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.contact') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.email') }}
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-office let-rowIndex="rowIndex">
                                    <tr [ngClass]="{ 'text-button-confirm fw-bold': office.isActive === null }">
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.name"
                                            [title]="office.name">
                                            <span class="multiline-ellipsis">{{ office.name }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.location"
                                            [title]="office.location">
                                            <span class="multiline-ellipsis">{{ office.location }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.longitude"
                                            [title]="office.longitude">
                                            <span class="multiline-ellipsis"
                                                >{{ office.longitude }} {{ office.latitude }}</span
                                            >
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.description"
                                            [title]="office.description">
                                            <span class="multiline-ellipsis">{{ office.description }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.workingHours"
                                            [title]="office.workingHours">
                                            <span class="multiline-ellipsis">{{ office.workingHours }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.contact"
                                            [title]="office.contact">
                                            <span class="multiline-ellipsis">{{ office.contact }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.email"
                                            [title]="office.email">
                                            <span class="multiline-ellipsis">{{ office.email }}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="7">
                                            <span
                                                class="d-flex align-items-center flex-column empty-message-container bg-background-light-grey">
                                                <img src="/assets/images/noresults.png" [alt]="t('aria.txtLogo')" />
                                                <span class="text-text-light" [attr.aria-label]="t('global.txtNoData')">
                                                    {{ t('global.txtNoData') }}
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.centers.register.employees')">
                            <p-table
                                [value]="circumstanceDetails.employees || []"
                                [tableStyle]="{ 'min-width': '100%' }"
                                [rowHover]="true"
                                [rowSelectable]="false">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.register.administratorUidType') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtName') }}
                                            <p-sortIcon field="name"></p-sortIcon>
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtNameLatin') }}
                                            <p-sortIcon field="nameLatin"></p-sortIcon>
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtEmail') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtPhone') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.centers.center-preview.users-table.txtRole') }}
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-user let-rowIndex="rowIndex">
                                    <tr [ngClass]="{ 'text-button-confirm fw-bold': user.isActive === null }">
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.citizenIdentifierNumber"
                                            [title]="user.citizenIdentifierNumber">
                                            <span
                                                class="multiline-ellipsis"
                                                appPersonalIdentifier
                                                [identifier]="user.citizenIdentifierNumber"
                                                [identifierType]="user.citizenIdentifierType"></span>
                                        </td>
                                        <td style="max-width: 18rem" [attr.aria-label]="user.name" [title]="user.name">
                                            <span class="multiline-ellipsis">{{ user.name }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.nameLatin"
                                            [title]="user.nameLatin">
                                            <span class="multiline-ellipsis">{{ user.nameLatin }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.email"
                                            [title]="user.email">
                                            <span class="multiline-ellipsis">{{ user.email }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.phoneNumber"
                                            [title]="user.phoneNumber">
                                            <span class="multiline-ellipsis">{{ user.phoneNumber }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="roleNames(user.roles)"
                                            [title]="roleNames(user.roles)">
                                            <span class="multiline-ellipsis">{{ roleNames(user.roles) }}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="6">
                                            <span
                                                class="d-flex align-items-center flex-column empty-message-container bg-background-light-grey">
                                                <img src="/assets/images/noresults.png" [alt]="t('aria.txtLogo')" />
                                                <span class="text-text-light" [attr.aria-label]="t('global.txtNoData')">
                                                    {{ t('global.txtNoData') }}
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.centers.register.files')">
                            <app-files-table [files]="circumstanceDetails.attachments || []"></app-files-table>
                        </p-tabPanel>
                    </p-tabView>
                </ng-container>
                <ng-template #elseBlock>
                    <p-tabView>
                        <p-tabPanel [header]="t('modules.centers.register.details')">
                            <p-skeleton styleClass="mb-3" height="1rem" width="8rem"></p-skeleton>
                            <p-skeleton styleClass="mb-3" height="1rem" width="16rem"></p-skeleton>

                            <p-skeleton styleClass="mb-3" height="1rem" width="8rem"></p-skeleton>
                            <p-skeleton styleClass="mb-3" height="1rem" width="16rem"></p-skeleton>

                            <p-skeleton styleClass="mb-3" height="1rem" width="8rem"></p-skeleton>
                            <p-skeleton styleClass="mb-3" height="1rem" width="16rem"></p-skeleton>
                        </p-tabPanel>
                    </p-tabView>
                </ng-template>

                <div class="mt-4 d-flex gap-4">
                    <a [routerLink]="['/centers/registrations']">
                        <button
                            *transloco="let buttonT"
                            pButton
                            type="button"
                            class="p-button-primary"
                            [label]="buttonT('global.txtBack')"
                            [attr.aria-label]="buttonT('global.txtBack')"></button>
                    </a>
                    <ng-container *ngIf="circumstanceDetails">
                        <app-center-circumstance-action-dialog
                            [circumstance]="circumstanceDetails"
                            (successCallback)="onClosePreview()"></app-center-circumstance-action-dialog>
                    </ng-container>
                </div>
            </p-card>
        </div>
    </div>
</section>
