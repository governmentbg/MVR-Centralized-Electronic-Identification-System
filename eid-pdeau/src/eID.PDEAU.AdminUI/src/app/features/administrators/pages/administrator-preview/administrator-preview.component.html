<section class="h-100 provider-register-section" *transloco="let t">
    <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>
    <div class="row">
        <div class="col">
            <h4 class="mb-4 text-text-default">
                {{ t('modules.administrators.registrations.preview') }}
            </h4>
            <p-card>
                <ng-container *ngIf="!loading && application; else elseBlock">
                    <p-tabView>
                        <p-tabPanel [header]="t('modules.administrators.register.generalInformation')">
                            <div class="mb-4">
                                <h6 class="text-text-default">
                                    {{ t('modules.administrators.administrator-preview.txtStatus') }}
                                </h6>
                                <span class="multiline-ellipsis">{{
                                    t('modules.administrators.circumstances.statuses.' + application.managerStatus)
                                }}</span>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <h6 class="text-text-default mb-4">
                                        {{ t('modules.administrators.register.applicantLegalData') }}
                                    </h6>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.administrators.register.administrativeBodyName')"
                                        [value]="application.name" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="
                                            t('modules.administrators.register.administrativeBodyIdentificationNumber')
                                        "
                                        [value]="application.code" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.administrators.register.companyNameLatin')"
                                        [value]="application.nameLatin" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.administrators.register.administrativeBodyBulstat')"
                                        [value]="application.eikNumber" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.administrators.register.homePage')"
                                        [value]="application.homePage" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.administrators.register.administrativeBodyAddress')"
                                        [value]="application.address" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.administrators.register.administrativeBodyEmail')"
                                        [value]="application.email" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.administrators.register.administrativeBodyPhone')"
                                        [value]="application.phone" />
                                </div>
                                <div class="col-lg-5">
                                    <app-preview-field
                                        [label]="t('modules.administrators.register.generalInformation')"
                                        [value]="application.description" />
                                </div>
                            </div>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.administrators.register.legalRepresentatives')">
                            <p-table
                                [value]="application.authorizedPersons || []"
                                [tableStyle]="{ 'min-width': '100%' }"
                                [rowHover]="true"
                                [rowSelectable]="false">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th pSortableColumn="citizenIdentifierNumber" class="text-nowrap">
                                            {{ t('modules.administrators.register.administratorUidType') }}
                                            <p-sortIcon field="citizenIdentifierNumber"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="name" class="text-nowrap">
                                            {{ t('modules.administrators.administrator-preview.users-table.txtName') }}
                                            <p-sortIcon field="name"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="nameLatin" class="text-nowrap">
                                            {{
                                                t(
                                                    'modules.administrators.administrator-preview.users-table.txtNameLatin'
                                                )
                                            }}
                                            <p-sortIcon field="nameLatin"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="email" class="text-nowrap">
                                            {{ t('modules.administrators.administrator-preview.users-table.txtEmail') }}
                                            <p-sortIcon field="email"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="phoneNumber" class="text-nowrap">
                                            {{ t('modules.administrators.administrator-preview.users-table.txtPhone') }}
                                            <p-sortIcon field="phoneNumber"></p-sortIcon>
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-user let-rowIndex="rowIndex">
                                    <tr>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.citizenIdentifierNumber"
                                            [title]="user.citizenIdentifierNumber">
                                            <span
                                                class="multiline-ellipsis"
                                                appPersonalIdentifier
                                                [identifier]="user.citizenIdentifierNumber"
                                                [identifierType]="user.citizenIdentifierType"></span>
                                        </td>
                                        <td style="max-width: 18rem" [attr.aria-label]="user.name" [title]="user.name">
                                            <span class="multiline-ellipsis">{{ user.name }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.nameLatin"
                                            [title]="user.nameLatin">
                                            <span class="multiline-ellipsis">{{ user.nameLatin }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.email"
                                            [title]="user.email">
                                            <span class="multiline-ellipsis">{{ user.email }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.phoneNumber"
                                            [title]="user.phoneNumber">
                                            <span class="multiline-ellipsis">{{ user.phoneNumber }}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="5">
                                            <span
                                                class="d-flex align-items-center flex-column empty-message-container bg-background-light-grey">
                                                <img src="/assets/images/noresults.png" [alt]="t('aria.txtLogo')" />
                                                <span class="text-text-light" [attr.aria-label]="t('global.txtNoData')">
                                                    {{ t('global.txtNoData') }}
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.administrators.register.devices')">
                            <p-table
                                [value]="application.devices || []"
                                [tableStyle]="{ 'min-width': '100%' }"
                                [rowHover]="true"
                                [rowSelectable]="false">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th pSortableColumn="name" class="text-nowrap">
                                            {{ t('modules.administrators.register.deviceName') }}
                                            <p-sortIcon field="name"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="type" class="text-nowrap">
                                            {{ t('modules.administrators.register.deviceType') }}
                                            <p-sortIcon field="type"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="description" class="text-nowrap">
                                            {{ t('modules.administrators.register.description') }}
                                            <p-sortIcon field="description"></p-sortIcon>
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.administrators.register.link') }}
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-device let-rowIndex="rowIndex">
                                    <tr>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="device.name"
                                            [title]="device.name">
                                            <span class="multiline-ellipsis">{{ device.name }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="device.type"
                                            [title]="device.type">
                                            <span class="multiline-ellipsis">{{ device.type }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="device.description"
                                            [title]="device.description">
                                            <span class="multiline-ellipsis">{{ device.description }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="
                                                device.authorizationLink
                                                    ? device.authorizationLink
                                                    : device.backchannelAuthorizationLink
                                            "
                                            [title]="
                                                device.authorizationLink
                                                    ? device.authorizationLink
                                                    : device.backchannelAuthorizationLink
                                            ">
                                            <span class="multiline-ellipsis">{{
                                                device.authorizationLink
                                                    ? device.authorizationLink
                                                    : device.backchannelAuthorizationLink
                                            }}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="4">
                                            <span
                                                class="d-flex align-items-center flex-column empty-message-container bg-background-light-grey">
                                                <img src="/assets/images/noresults.png" [alt]="t('aria.txtLogo')" />
                                                <span class="text-text-light" [attr.aria-label]="t('global.txtNoData')">
                                                    {{ t('global.txtNoData') }}
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.administrators.register.offices')">
                            <p-table
                                [value]="application.eidManagerFrontOffices || []"
                                [tableStyle]="{ 'min-width': '100%' }"
                                [rowHover]="true"
                                [rowSelectable]="false">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th pSortableColumn="name" class="text-nowrap">
                                            {{ t('modules.administrators.register.officeName') }}
                                            <p-sortIcon field="name"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="location" class="text-nowrap">
                                            {{ t('modules.administrators.register.officeAddress') }}
                                            <p-sortIcon field="location"></p-sortIcon>
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.administrators.register.officeCoordinates') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.administrators.register.officeGeneralInformation') }}
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.administrators.register.workingHours') }}
                                        </th>
                                        <th pSortableColumn="contact" class="text-nowrap">
                                            {{ t('modules.administrators.register.contact') }}
                                            <p-sortIcon field="contact"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="email" class="text-nowrap">
                                            {{ t('modules.administrators.register.email') }}
                                            <p-sortIcon field="email"></p-sortIcon>
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-office let-rowIndex="rowIndex">
                                    <tr>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.name"
                                            [title]="office.name">
                                            <span class="multiline-ellipsis">{{ office.name }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.location"
                                            [title]="office.location">
                                            <span class="multiline-ellipsis">{{ office.location }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.longitude"
                                            [title]="office.longitude">
                                            <span class="multiline-ellipsis"
                                                >{{ office.longitude }} {{ office.latitude }}</span
                                            >
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.description"
                                            [title]="office.description">
                                            <span class="multiline-ellipsis">{{ office.description }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.workingHours"
                                            [title]="office.workingHours">
                                            <span class="multiline-ellipsis">{{ office.workingHours }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.contact"
                                            [title]="office.contact">
                                            <span class="multiline-ellipsis">{{ office.contact }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="office.email"
                                            [title]="office.email">
                                            <span class="multiline-ellipsis">{{ office.email }}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="7">
                                            <span
                                                class="d-flex align-items-center flex-column empty-message-container bg-background-light-grey">
                                                <img src="/assets/images/noresults.png" [alt]="t('aria.txtLogo')" />
                                                <span class="text-text-light" [attr.aria-label]="t('global.txtNoData')">
                                                    {{ t('global.txtNoData') }}
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.administrators.register.employees')">
                            <p-table
                                [value]="application.employees || []"
                                [tableStyle]="{ 'min-width': '100%' }"
                                [rowHover]="true"
                                [rowSelectable]="false">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th pSortableColumn="citizenIdentifierNumber" class="text-nowrap">
                                            {{ t('modules.administrators.register.administratorUidType') }}
                                            <p-sortIcon field="citizenIdentifierNumber"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="name" class="text-nowrap">
                                            {{ t('modules.administrators.administrator-preview.users-table.txtName') }}
                                            <p-sortIcon field="name"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="nameLatin" class="text-nowrap">
                                            {{
                                                t(
                                                    'modules.administrators.administrator-preview.users-table.txtNameLatin'
                                                )
                                            }}
                                            <p-sortIcon field="nameLatin"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="email" class="text-nowrap">
                                            {{ t('modules.administrators.administrator-preview.users-table.txtEmail') }}
                                            <p-sortIcon field="email"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="phoneNumber" class="text-nowrap">
                                            {{ t('modules.administrators.administrator-preview.users-table.txtPhone') }}
                                            <p-sortIcon field="phoneNumber"></p-sortIcon>
                                        </th>
                                        <th class="text-nowrap">
                                            {{ t('modules.administrators.administrator-preview.users-table.txtRole') }}
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-user let-rowIndex="rowIndex">
                                    <tr>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.citizenIdentifierNumber"
                                            [title]="user.citizenIdentifierNumber">
                                            <span
                                                class="multiline-ellipsis"
                                                appPersonalIdentifier
                                                [identifier]="user.citizenIdentifierNumber"
                                                [identifierType]="user.citizenIdentifierType"></span>
                                        </td>
                                        <td style="max-width: 18rem" [attr.aria-label]="user.name" [title]="user.name">
                                            <span class="multiline-ellipsis">{{ user.name }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.nameLatin"
                                            [title]="user.nameLatin">
                                            <span class="multiline-ellipsis">{{ user.nameLatin }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.email"
                                            [title]="user.email">
                                            <span class="multiline-ellipsis">{{ user.email }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="user.phoneNumber"
                                            [title]="user.phoneNumber">
                                            <span class="multiline-ellipsis">{{ user.phoneNumber }}</span>
                                        </td>
                                        <td
                                            style="max-width: 18rem"
                                            [attr.aria-label]="roleNames(user.roles)"
                                            [title]="roleNames(user.roles)">
                                            <span class="multiline-ellipsis">{{ roleNames(user.roles) }}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="6">
                                            <span
                                                class="d-flex align-items-center flex-column empty-message-container bg-background-light-grey">
                                                <img src="/assets/images/noresults.png" [alt]="t('aria.txtLogo')" />
                                                <span class="text-text-light" [attr.aria-label]="t('global.txtNoData')">
                                                    {{ t('global.txtNoData') }}
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.administrators.history.txtTitle')">
                            <app-notes [notes]="application.notes"></app-notes>
                        </p-tabPanel>

                        <p-tabPanel [header]="t('modules.administrators.register.files')">
                            <app-files-table [files]="application.attachments || []"></app-files-table>
                        </p-tabPanel>
                    </p-tabView>
                </ng-container>
                <ng-template #elseBlock>
                    <p-tabView>
                        <p-tabPanel [header]="t('modules.administrators.register.generalInformation')">
                            <p-skeleton styleClass="mb-3" height="1rem" width="8rem"></p-skeleton>
                            <p-skeleton styleClass="mb-3" height="1rem" width="16rem"></p-skeleton>

                            <p-skeleton styleClass="mb-3" height="1rem" width="8rem"></p-skeleton>
                            <p-skeleton styleClass="mb-3" height="1rem" width="16rem"></p-skeleton>

                            <p-skeleton styleClass="mb-3" height="1rem" width="8rem"></p-skeleton>
                            <p-skeleton styleClass="mb-3" height="1rem" width="16rem"></p-skeleton>
                        </p-tabPanel>
                    </p-tabView>
                </ng-template>

                <div class="mt-4 d-flex gap-4">
                    <a [routerLink]="['/administrators/registrations']">
                        <button
                            *transloco="let buttonT"
                            pButton
                            type="button"
                            class="p-button-primary"
                            [label]="buttonT('global.txtBack')"
                            [attr.aria-label]="buttonT('global.txtBack')"></button>
                    </a>
                    <ng-container *ngIf="application && application.managerStatus === ManagerStatus.TECHNICAL_CHECK">
                        <button
                            pButton
                            type="button"
                            class="p-button p-button-success"
                            [label]="t('modules.administrators.circumstances.txtActivate')"
                            (click)="show(CircumstanceStatus.APPROVED)"></button>
                    </ng-container>
                    <div class="d-flex gap-4">
                        <ng-container *ngIf="application">
                            <app-administrator-status-action-dialog
                                [circumstance]="application"
                                [managerStatus]="application.managerStatus"
                                (successCallback)="onClosePreview()"></app-administrator-status-action-dialog>
                        </ng-container>
                    </div>
                </div>
            </p-card>
        </div>
    </div>
</section>
<form [formGroup]="form" (ngSubmit)="submit()" *transloco="let t">
    <p-dialog
        [(visible)]="showDialog"
        [modal]="true"
        [draggable]="false"
        [resizable]="false"
        [style]="{ width: '50vw', maxWidth: '700px' }"
        [styleClass]="dialogStyleClass">
        <ng-template pTemplate="header">
            <h3 class="text-white">{{ titleTranslation }}</h3>
        </ng-template>
        <div class="pt-4 d-flex flex-column gap-2" formGroupName="note">
            <h5>{{ descriptionTranslation }}</h5>
            <textarea
                [placeholder]="t('global.txtInputPlaceholder')"
                class="w-100 p-2"
                rows="5"
                pInputTextarea
                formControlName="content"></textarea>
            <app-error-field
                [formControlInstance]="form.controls.note.controls.content"
                translationPrefix="modules.administrators.administrator-preview.return-dialog.errors" />
        </div>
        <div>
            <div class="d-flex align-items-end gap-3">
                <div>
                    <label for="document">{{ t('modules.administrators.register.files') }}</label>
                    <p-dropdown
                        inputId="document"
                        [options]="documentTypes"
                        optionLabel="name"
                        optionValue="id"
                        [(ngModel)]="documentType"
                        [ngModelOptions]="{ standalone: true }"
                        styleClass="w-100"
                        appendTo="body"></p-dropdown>
                </div>
                <p-button
                    [label]="t('modules.administrators.register.txtAddFile')"
                    icon="pi pi-plus"
                    (onClick)="addFile($event)"></p-button>
            </div>

            <p-fileUpload
                styleClass="d-none"
                #documentComponent
                [showUploadButton]="false"
                [customUpload]="true"
                [multiple]="false"
                [previewWidth]="1"
                (onSelect)="onFileChange($event)"
                accept=".pdf">
                <ng-template let-file pTemplate="file">
                    <div class="d-flex gap-2">
                        {{ file.name }}
                    </div>
                </ng-template>
            </p-fileUpload>

            <ul class="mt-4 list-unstyled">
                <li *ngFor="let attachment of form.controls.documents.controls; let i = index">
                    <i class="material-icons-outlined">&#xe873;</i> {{ attachment.getRawValue().fileName }}
                </li>
            </ul>
        </div>
        <ng-template pTemplate="footer">
            <p-button
                styleClass="p-button-primary"
                [label]="t('global.txtCancel')"
                [ariaLabel]="t('global.txtCancel')"
                (click)="hide()"></p-button>
            <p-button
                [disabled]="actionMutation.isLoading"
                [loading]="actionMutation.isLoading"
                [label]="titleTranslation"
                [ariaLabel]="titleTranslation"
                [styleClass]="buttonStyleClass"
                type="submit"></p-button>
        </ng-template>
    </p-dialog>
</form>
