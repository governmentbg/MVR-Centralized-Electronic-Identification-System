<section *transloco="let t">
    <h4 class="mb-4 text-uppercase" [attr.aria-label]="t('modules.channels.txtChannelsTitle')">
        {{ t('modules.channels.txtChannelsTitle') }}
    </h4>

    <p-toast key="toast" position="bottom-right"></p-toast>
    <p-confirmDialog [style]="{ width: '50vw', maxWidth: '700px' }" [blockScroll]="false"></p-confirmDialog>
    <p-dialog
        [blockScroll]="false"
        [header]="t('global.txtConfirmation')"
        [(visible)]="rejectDialogVisible"
        [modal]="true"
        [draggable]="false"
        [style]="{ width: '50vw', maxWidth: '700px' }">
        <p>
            {{ t('modules.channels.txtRejectConfirm') }}
        </p>
        <form [formGroup]="rejectForm" (ngSubmit)="onRejectFormSubmit()">
            <div>
                <label for="reason" class="form-label"
                    >{{ t('modules.channels.txtReason') }} <span class="text-danger">*</span></label
                >
                <textarea
                    id="reason"
                    rows="5"
                    cols="30"
                    pInputTextarea
                    formControlName="reason"
                    maxlength="1024"
                    class="w-100"></textarea>
                <div class="text-danger validation-text">
                    <span
                        *ngIf="
                            rejectForm.controls.reason.invalid &&
                            (rejectForm.controls.reason.dirty || rejectForm.controls.reason.touched)
                        ">
                        {{
                            t('validations.txtPleaseEnterField', {
                                field: t('modules.channels.txtReason')
                            })
                        }}
                    </span>
                </div>
            </div>
            <div class="d-flex justify-content-end mt-4">
                <p-button
                    [icon]="'pi pi-times'"
                    iconPos="left"
                    [loading]="loading"
                    [label]="t('primeng.reject')"
                    (onClick)="toggleRejectFormVisibility()"
                    styleClass="p-button p-button-danger me-2"></p-button>
                <p-button
                    [icon]="'pi pi-check'"
                    iconPos="left"
                    [loading]="loading"
                    [label]="t('primeng.accept')"
                    type="submit"
                    styleClass="p-button p-button-primary"></p-button>
            </div>
        </form>
    </p-dialog>
    <div class="p-card p-4">
        <div class="mb-4">
            <p-selectButton
                [options]="tabOptions"
                [(ngModel)]="value"
                [multiple]="false"
                optionLabel="name"
                optionValue="value"
                (ngModelChange)="activeItemChange($event)">
                <ng-template let-item>
                    <span class="p-button-label">{{ item.label }}</span>
                </ng-template>
            </p-selectButton>
        </div>

        <p-table
            #dt
            [value]="channels"
            [rows]="10"
            [paginator]="false"
            [tableStyle]="{ 'min-width': '100%' }"
            [(selection)]="selectedChannels"
            [rowHover]="true"
            dataKey="name"
            [showCurrentPageReport]="true"
            [loading]="loading"
            loadingIcon="pi pi-spin pi-spinner">
            <ng-template pTemplate="header">
                <tr>
                    <th class="text-nowrap" [attr.aria-label]="modifiedOnColumnLabel">
                        {{ modifiedOnColumnLabel }}
                    </th>
                    <th class="text-nowrap" [attr.aria-label]="t('modules.channels.txtSystemName')">
                        {{ t('modules.channels.txtSystemName') }}
                    </th>
                    <th class="text-nowrap" [attr.aria-label]="t('modules.channels.txtChannel')">
                        {{ t('modules.channels.txtChannel') }}
                    </th>
                    <th class="text-nowrap" [attr.aria-label]="t('modules.channels.txtDescription')">
                        {{ t('modules.channels.txtDescription') }}
                    </th>
                    <th class="text-nowrap" [attr.aria-label]="t('modules.channels.txtCallbackUrl')">
                        {{ t('modules.channels.txtCallbackUrl') }}
                    </th>
                    <th class="text-nowrap" [attr.aria-label]="t('modules.channels.txtInfoUrl')">
                        {{ t('modules.channels.txtInfoUrl') }}
                    </th>
                    <th class="text-nowrap" [attr.aria-label]="t('modules.channels.txtEmail')">
                        {{ t('modules.channels.txtEmail') }}
                    </th>
                    <th class="text-nowrap" [attr.aria-label]="t('modules.channels.txtPrice')">
                        {{ t('modules.channels.txtPrice') }}
                    </th>
                    <th
                        style="width: 25rem"
                        class="text-nowrap"
                        *ngIf="activeItem === 'rejected'"
                        [attr.aria-label]="t('modules.channels.txtReason')">
                        {{ t('modules.channels.txtReason') }}
                    </th>
                    <th class="text-nowrap" *ngIf="activeItem !== 'rejected'" [attr.aria-label]="t('global.txtAction')">
                        {{ t('global.txtAction') }}
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
                <tr>
                    <td>
                        <p-skeleton></p-skeleton>
                    </td>
                    <td>
                        <p-skeleton></p-skeleton>
                    </td>
                    <td>
                        <p-skeleton></p-skeleton>
                    </td>
                    <td>
                        <p-skeleton></p-skeleton>
                    </td>
                    <td>
                        <p-skeleton></p-skeleton>
                    </td>
                    <td>
                        <p-skeleton></p-skeleton>
                    </td>
                    <td>
                        <p-skeleton></p-skeleton>
                    </td>
                    <td>
                        <p-skeleton></p-skeleton>
                    </td>
                    <td *ngIf="activeItem === 'rejected'">
                        <p-skeleton></p-skeleton>
                    </td>
                    <td style="width: 10rem" *ngIf="activeItem !== 'rejected'">
                        <p-skeleton></p-skeleton>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-channel>
                <tr>
                    <td>
                        <span class="text-nowrap" [attr.aria-label]="channel.modifiedOn">
                            {{ channel.modifiedOn | translocoDate : { timeStyle: 'medium' } }}
                        </span>
                    </td>
                    <td>
                        <span class="text-nowrap" [attr.aria-label]="channel.systemName">
                            {{ channel.systemName }}
                        </span>
                    </td>
                    <td>
                        <span class="text-break" [attr.aria-label]="getChannelNameTranslation(channel)">{{
                            getChannelNameTranslation(channel)
                        }}</span>
                    </td>
                    <td>
                        <span class="text-break" [attr.aria-label]="getChannelDescriptionTranslation(channel)">{{
                            getChannelDescriptionTranslation(channel)
                        }}</span>
                    </td>
                    <td>
                        <span class="text-break" [attr.aria-label]="channel.callbackUrl">{{
                            channel.callbackUrl
                        }}</span>
                    </td>
                    <td>
                        <span class="text-break" [attr.aria-label]="channel.infoUrl">{{ channel.infoUrl }}</span>
                    </td>
                    <td>
                        <span class="text-break" [attr.aria-label]="channel.email">{{ channel.email }}</span>
                    </td>
                    <td [attr.aria-label]="channel.price">{{ channel.price }}</td>
                    <td [attr.aria-label]="channel.price" *ngIf="activeItem === 'rejected'">{{ channel.reason }}</td>
                    <td style="width: 10rem" *ngIf="activeItem !== 'rejected'">
                        <div class="d-flex">
                            <p-button
                                *ngIf="activeItem === 'approved'"
                                (click)="doAction(channel, actions.deactivate)"
                                [label]="t('modules.channels.txtArchiveAction')"
                                icon="pi pi-times"
                                iconPos="right"
                                styleClass="p-button-sm p-button-danger"
                                [ariaLabel]="t('modules.channels.txtArchiveAction')"></p-button>

                            <p-button
                                *ngIf="activeItem === 'archived'"
                                (click)="doAction(channel, actions.reactivate)"
                                [label]="t('modules.channels.txtRestoreAction')"
                                icon="pi pi-check"
                                iconPos="right"
                                styleClass="p-button-sm me-3 p-button-success"
                                [ariaLabel]="t('modules.channels.txtRestoreAction')"></p-button>

                            <p-button
                                *ngIf="activeItem === 'pending'"
                                (click)="doAction(channel, actions.approve)"
                                [label]="t('modules.channels.txtApprove')"
                                icon="pi pi-check"
                                iconPos="right"
                                styleClass="p-button-sm me-3 p-button-success"
                                [ariaLabel]="t('modules.channels.txtApprove')"></p-button>
                            <p-button
                                *ngIf="activeItem === 'pending'"
                                (click)="doAction(channel, actions.reject)"
                                [label]="t('modules.channels.txtReject')"
                                icon="pi pi-times"
                                iconPos="right"
                                styleClass="p-button-sm me-3 p-button-danger"
                                [ariaLabel]="t('modules.channels.txtReject')"></p-button>
                            <p-button
                                *ngIf="activeItem === 'pending'"
                                (click)="doAction(channel, actions.test)"
                                [label]="t('modules.channels.txtTest')"
                                icon="pi pi-sync"
                                iconPos="right"
                                styleClass="p-button-sm me-3"
                                [ariaLabel]="t('modules.channels.txtTest')"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="9">
                        <span
                            class="d-flex align-items-center flex-column empty-message-container bg-background-light-grey">
                            <img src="/assets/images/noresults.png" />
                            <span class="text-text-light" [attr.aria-label]="t('global.txtNoRecordsFound')">
                                {{ t('global.txtNoRecordsFound') }}
                            </span>
                        </span>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</section>
